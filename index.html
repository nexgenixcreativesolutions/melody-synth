<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Melody Synth Go</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet" />

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ADMOB: Replace with your real Ad Unit IDs
       Test IDs are used here for development.
       Android Rewarded Test ID: ca-app-pub-3940256099942544/5224354917
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

  <style>
    :root {
      --bg:        #0a0a0f;
      --surface:   #13131c;
      --card:      #1c1c2a;
      --border:    #2a2a3d;
      --accent:    #ff4d6d;
      --gold:      #ffc844;
      --teal:      #00e5c3;
      --text:      #f0f0f8;
      --muted:     #6b6b88;
      --radius:    18px;
      --font-head: 'Bebas Neue', sans-serif;
      --font-body: 'DM Sans', sans-serif;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--font-body);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* â”€â”€ Noise texture overlay â”€â”€ */
    body::before {
      content: '';
      position: fixed; inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
      pointer-events: none; z-index: 0;
    }

    /* â”€â”€ Header â”€â”€ */
    header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 20px 24px 12px;
      position: relative; z-index: 10;
    }
    .logo {
      font-family: var(--font-head);
      font-size: 2rem; letter-spacing: 2px;
      background: linear-gradient(120deg, var(--accent), var(--gold));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .credits-badge {
      display: flex; align-items: center; gap: 6px;
      background: var(--card); border: 1px solid var(--border);
      border-radius: 50px; padding: 8px 16px;
      font-size: 0.95rem; font-weight: 600;
      cursor: pointer; transition: border-color 0.2s;
    }
    .credits-badge:active { border-color: var(--gold); }
    .credits-badge .coin { font-size: 1.1rem; }
    .credits-count { color: var(--gold); }

    /* â”€â”€ Section titles â”€â”€ */
    .section-title {
      font-family: var(--font-head);
      font-size: 1.4rem; letter-spacing: 1.5px;
      color: var(--muted); padding: 24px 24px 12px;
      text-transform: uppercase;
    }

    /* â”€â”€ Record Panel â”€â”€ */
    .record-panel {
      margin: 0 16px;
      background: linear-gradient(135deg, #1a0a1e, #0d1a2e);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 28px 20px;
      text-align: center;
      position: relative; overflow: hidden;
    }
    .record-panel::before {
      content: '';
      position: absolute; inset: 0;
      background: radial-gradient(ellipse at 50% 0%, rgba(255,77,109,0.15) 0%, transparent 70%);
      pointer-events: none;
    }
    .record-btn {
      width: 88px; height: 88px;
      border-radius: 50%;
      background: linear-gradient(145deg, var(--accent), #c0192f);
      border: none; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 16px;
      box-shadow: 0 0 0 0 rgba(255,77,109,0.4);
      transition: transform 0.15s, box-shadow 0.15s;
      position: relative; z-index: 1;
    }
    .record-btn.recording {
      animation: pulse-ring 1.2s ease-out infinite;
    }
    .record-btn:active { transform: scale(0.94); }
    .record-btn svg { width: 32px; height: 32px; fill: white; }
    @keyframes pulse-ring {
      0%   { box-shadow: 0 0 0 0 rgba(255,77,109,0.6); }
      70%  { box-shadow: 0 0 0 24px rgba(255,77,109,0); }
      100% { box-shadow: 0 0 0 0 rgba(255,77,109,0); }
    }

    .record-label {
      font-size: 0.9rem; color: var(--muted);
      margin-bottom: 8px; position: relative; z-index: 1;
    }
    .record-status {
      font-size: 1.05rem; font-weight: 600;
      color: var(--text); min-height: 1.5em;
      position: relative; z-index: 1;
    }
    .record-status.active { color: var(--accent); }

    /* Waveform visualizer */
    .waveform {
      display: flex; align-items: center; justify-content: center;
      gap: 3px; height: 40px; margin: 16px 0 0;
      position: relative; z-index: 1;
    }
    .wave-bar {
      width: 4px; border-radius: 4px;
      background: var(--accent); opacity: 0.4;
      height: 6px; transition: height 0.1s;
    }
    .waveform.active .wave-bar { animation: wave-anim 0.6s ease-in-out infinite alternate; opacity: 1; }
    @keyframes wave-anim {
      0%   { height: 4px; }
      100% { height: 32px; }
    }
    .wave-bar:nth-child(2)  { animation-delay: 0.05s; }
    .wave-bar:nth-child(3)  { animation-delay: 0.10s; }
    .wave-bar:nth-child(4)  { animation-delay: 0.15s; }
    .wave-bar:nth-child(5)  { animation-delay: 0.20s; }
    .wave-bar:nth-child(6)  { animation-delay: 0.25s; }
    .wave-bar:nth-child(7)  { animation-delay: 0.20s; }
    .wave-bar:nth-child(8)  { animation-delay: 0.15s; }
    .wave-bar:nth-child(9)  { animation-delay: 0.10s; }
    .wave-bar:nth-child(10) { animation-delay: 0.05s; }

    /* â”€â”€ Instrument Grid â”€â”€ */
    .instruments-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      padding: 0 16px;
    }
    .instrument-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 18px 14px;
      cursor: pointer;
      transition: border-color 0.2s, transform 0.15s, background 0.2s;
      position: relative; overflow: hidden;
    }
    .instrument-card:active { transform: scale(0.97); }
    .instrument-card.selected {
      border-color: var(--teal);
      background: rgba(0, 229, 195, 0.08);
    }
    .instrument-card.selected::after {
      content: 'âœ“';
      position: absolute; top: 10px; right: 12px;
      color: var(--teal); font-size: 0.85rem; font-weight: 700;
    }
    .instrument-icon { font-size: 2.2rem; margin-bottom: 8px; display: block; }
    .instrument-name {
      font-weight: 600; font-size: 0.95rem;
      margin-bottom: 2px;
    }
    .instrument-cost {
      font-size: 0.78rem; color: var(--gold);
      display: flex; align-items: center; gap: 4px;
    }

    /* â”€â”€ Convert Button â”€â”€ */
    .convert-wrap {
      padding: 20px 16px;
    }
    .convert-btn {
      width: 100%;
      background: linear-gradient(135deg, var(--teal), #008f7a);
      border: none; border-radius: var(--radius);
      color: #0a0a0f; font-family: var(--font-head);
      font-size: 1.4rem; letter-spacing: 2px;
      padding: 18px;
      cursor: pointer;
      transition: opacity 0.2s, transform 0.15s;
      display: flex; align-items: center; justify-content: center; gap: 10px;
    }
    .convert-btn:disabled { opacity: 0.35; cursor: not-allowed; }
    .convert-btn:not(:disabled):active { transform: scale(0.98); }

    /* â”€â”€ Ad Banner â”€â”€ */
    .ad-banner-wrap {
      margin: 0 16px 16px;
      background: var(--surface);
      border: 1px dashed var(--border);
      border-radius: 12px;
      min-height: 60px;
      display: flex; align-items: center; justify-content: center;
      overflow: hidden;
      position: relative;
    }
    .ad-placeholder {
      font-size: 0.75rem; color: var(--muted);
      text-align: center; padding: 10px;
    }

    /* â”€â”€ Earn Credits Panel â”€â”€ */
    .earn-panel {
      margin: 0 16px 24px;
      background: linear-gradient(135deg, #0f1a10, #0a1520);
      border: 1px solid #2a3d2a;
      border-radius: var(--radius);
      padding: 20px;
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
    }
    .earn-info { flex: 1; }
    .earn-title {
      font-weight: 700; font-size: 1rem; margin-bottom: 4px;
    }
    .earn-desc { font-size: 0.82rem; color: var(--muted); line-height: 1.4; }
    .earn-btn {
      background: linear-gradient(135deg, var(--gold), #e0a800);
      border: none; border-radius: 50px;
      color: #0a0a0f; font-weight: 700; font-size: 0.9rem;
      padding: 12px 20px; white-space: nowrap;
      cursor: pointer; transition: transform 0.15s, opacity 0.2s;
      display: flex; align-items: center; gap: 6px;
    }
    .earn-btn:active { transform: scale(0.95); }
    .earn-btn:disabled { opacity: 0.5; cursor: not-allowed; }

    /* â”€â”€ Result Panel â”€â”€ */
    .result-panel {
      margin: 0 16px 20px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      display: none;
    }
    .result-panel.visible { display: block; }
    .result-header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 16px;
    }
    .result-title { font-family: var(--font-head); font-size: 1.3rem; letter-spacing: 1px; }
    .result-badge {
      background: rgba(0,229,195,0.15); color: var(--teal);
      border-radius: 50px; padding: 4px 12px;
      font-size: 0.78rem; font-weight: 600;
    }
    .result-waveform {
      height: 56px;
      background: linear-gradient(90deg,
        rgba(0,229,195,0.2) 0%, rgba(0,229,195,0.5) 20%,
        rgba(255,77,109,0.4) 40%, rgba(0,229,195,0.6) 60%,
        rgba(255,200,68,0.3) 80%, rgba(0,229,195,0.2) 100%);
      border-radius: 8px;
      margin-bottom: 16px;
      position: relative; overflow: hidden;
    }
    .result-waveform::after {
      content: '';
      position: absolute; inset: 0;
      background: repeating-linear-gradient(90deg,
        transparent 0px, transparent 6px,
        rgba(0,0,0,0.15) 6px, rgba(0,0,0,0.15) 7px);
    }
    .result-actions { display: flex; gap: 10px; }
    .play-btn, .download-btn {
      flex: 1; padding: 13px; border-radius: 12px;
      font-weight: 600; font-size: 0.9rem;
      cursor: pointer; transition: opacity 0.2s, transform 0.15s;
      display: flex; align-items: center; justify-content: center; gap: 8px;
      border: none;
    }
    .play-btn:active, .download-btn:active { transform: scale(0.97); }
    .play-btn {
      background: var(--surface); color: var(--text);
      border: 1px solid var(--border);
    }
    .download-btn {
      background: linear-gradient(135deg, var(--accent), #c0192f);
      color: white;
    }
    .download-cost {
      font-size: 0.75rem; opacity: 0.85;
      display: flex; align-items: center; gap: 3px;
    }

    /* â”€â”€ Modal Overlay â”€â”€ */
    .modal-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.85);
      z-index: 100;
      display: none; align-items: center; justify-content: center;
      padding: 20px;
      backdrop-filter: blur(4px);
    }
    .modal-overlay.open { display: flex; }
    .modal {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 28px 24px;
      width: 100%; max-width: 360px;
      text-align: center;
      animation: modal-in 0.25s ease;
    }
    @keyframes modal-in {
      from { transform: scale(0.9) translateY(20px); opacity: 0; }
      to   { transform: scale(1) translateY(0); opacity: 1; }
    }
    .modal-icon { font-size: 3rem; margin-bottom: 12px; }
    .modal-title {
      font-family: var(--font-head); font-size: 1.6rem;
      letter-spacing: 1.5px; margin-bottom: 8px;
    }
    .modal-desc { color: var(--muted); font-size: 0.9rem; line-height: 1.5; margin-bottom: 24px; }
    .modal-actions { display: flex; flex-direction: column; gap: 10px; }
    .modal-btn {
      width: 100%; padding: 15px; border-radius: 12px;
      font-weight: 700; font-size: 1rem;
      cursor: pointer; transition: opacity 0.2s, transform 0.15s;
      border: none;
    }
    .modal-btn:active { transform: scale(0.97); }
    .modal-btn-primary {
      background: linear-gradient(135deg, var(--gold), #e0a800);
      color: #0a0a0f;
    }
    .modal-btn-secondary {
      background: var(--surface); color: var(--muted);
      border: 1px solid var(--border);
    }

    /* â”€â”€ Ad Loading Screen â”€â”€ */
    .ad-loading {
      position: fixed; inset: 0;
      background: #000;
      z-index: 200;
      display: none; align-items: center; justify-content: center;
      flex-direction: column; gap: 20px;
    }
    .ad-loading.open { display: flex; }
    .ad-spinner {
      width: 48px; height: 48px;
      border: 3px solid var(--border);
      border-top-color: var(--gold);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .ad-loading-text { color: var(--muted); font-size: 0.9rem; }
    .ad-countdown {
      font-family: var(--font-head); font-size: 3rem;
      color: var(--gold); letter-spacing: 3px;
    }
    .ad-skip-area {
      margin-top: 20px;
      display: flex; flex-direction: column; align-items: center; gap: 10px;
    }
    .ad-skip-btn {
      background: var(--surface); color: var(--text);
      border: 1px solid var(--border); border-radius: 50px;
      padding: 10px 24px; font-weight: 600; font-size: 0.9rem;
      cursor: pointer; display: none;
    }
    .ad-note { font-size: 0.75rem; color: var(--muted); }

    /* â”€â”€ Toast â”€â”€ */
    .toast {
      position: fixed; bottom: 28px; left: 50%; transform: translateX(-50%) translateY(20px);
      background: var(--card); border: 1px solid var(--border);
      border-radius: 50px; padding: 12px 24px;
      font-size: 0.9rem; font-weight: 500;
      opacity: 0; transition: opacity 0.3s, transform 0.3s;
      z-index: 300; white-space: nowrap;
      pointer-events: none;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
    .toast.success { border-color: var(--teal); color: var(--teal); }
    .toast.error   { border-color: var(--accent); color: var(--accent); }

    /* â”€â”€ Bottom padding for scroll â”€â”€ */
    .bottom-spacer { height: 40px; }

    /* â”€â”€ Processing spinner on convert â”€â”€ */
    .processing-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.7);
      z-index: 150;
      display: none; align-items: center; justify-content: center;
      flex-direction: column; gap: 16px;
      backdrop-filter: blur(4px);
    }
    .processing-overlay.open { display: flex; }
    .processing-ring {
      width: 64px; height: 64px;
      border: 4px solid var(--border);
      border-top-color: var(--teal);
      border-radius: 50%;
      animation: spin 0.9s linear infinite;
    }
    .processing-text { font-family: var(--font-head); font-size: 1.4rem; letter-spacing: 2px; color: var(--teal); }
    .processing-sub  { font-size: 0.82rem; color: var(--muted); }
  </style>
</head>
<body>

  <!-- Header -->
  <header>
    <div class="logo">ğŸµ Melody Synth</div>
    <div class="credits-badge" onclick="showEarnModal()">
      <span class="coin">ğŸª™</span>
      <span class="credits-count" id="creditsDisplay">10</span>
      <span style="color:var(--muted);font-size:0.8rem"> credits</span>
    </div>
  </header>

  <!-- Record Panel -->
  <div class="section-title">Record Your Voice</div>
  <div class="record-panel">
    <button class="record-btn" id="recordBtn" onclick="toggleRecord()">
      <svg id="micIcon" viewBox="0 0 24 24"><path d="M12 1a4 4 0 0 1 4 4v6a4 4 0 0 1-8 0V5a4 4 0 0 1 4-4zm7 10a1 1 0 0 1 2 0 9 9 0 0 1-8 8.94V21h2a1 1 0 0 1 0 2H9a1 1 0 0 1 0-2h2v-1.06A9 9 0 0 1 3 11a1 1 0 0 1 2 0 7 7 0 0 0 14 0z"/></svg>
    </button>
    <div class="record-label">Tap to start recording</div>
    <div class="record-status" id="recordStatus">Ready</div>
    <div class="waveform" id="waveform">
      <div class="wave-bar"></div><div class="wave-bar"></div>
      <div class="wave-bar"></div><div class="wave-bar"></div>
      <div class="wave-bar"></div><div class="wave-bar"></div>
      <div class="wave-bar"></div><div class="wave-bar"></div>
      <div class="wave-bar"></div><div class="wave-bar"></div>
    </div>
  </div>

  <!-- Instrument Selection -->
  <div class="section-title">Choose Instrument</div>
  <div class="instruments-grid" id="instrumentsGrid">
    <!-- Populated by JS -->
  </div>

  <!-- Convert Button -->
  <div class="convert-wrap">
    <button class="convert-btn" id="convertBtn" onclick="startConvert()" disabled>
      <span>âš¡</span> CONVERT â€” <span id="convertCostLabel">2 ğŸª™</span>
    </button>
  </div>

  <!-- Result Panel -->
  <div class="result-panel" id="resultPanel">
    <div class="result-header">
      <div class="result-title" id="resultTitle">Piano Version</div>
      <div class="result-badge">âœ“ Ready</div>
    </div>
    <div class="result-waveform"></div>
    <div class="result-actions">
      <button class="play-btn" onclick="playResult()">â–¶ Play</button>
      <button class="download-btn" onclick="downloadResult()">
        â¬‡ Download
        <span class="download-cost">â€” 1 ğŸª™</span>
      </button>
    </div>
  </div>

  <!-- Earn Credits Panel -->
  <div class="section-title">Earn Free Credits</div>
  <div class="earn-panel">
    <div class="earn-info">
      <div class="earn-title">Watch a short ad</div>
      <div class="earn-desc">Earn +5 credits instantly.<br/>Free â€” no purchase needed.</div>
    </div>
    <button class="earn-btn" id="earnBtn" onclick="showEarnModal()">
      ğŸ¬ Watch Ad
    </button>
  </div>

  <!-- AdMob Banner Ad Placeholder -->
  <!-- In the compiled Android app, replace this div with your AdMob Banner View -->
  <div class="ad-banner-wrap" id="adBannerContainer">
    <div class="ad-placeholder" id="adPlaceholder">
      Advertisement<br/>
      <small style="font-size:0.65rem;opacity:0.5">(AdMob Banner â€” ca-app-pub-XXXXXXXXXXXXXXXX/XXXXXXXXXX)</small>
    </div>
  </div>

  <div class="bottom-spacer"></div>

  <!-- â”€â”€ Earn Credits Modal â”€â”€ -->
  <div class="modal-overlay" id="earnModal">
    <div class="modal">
      <div class="modal-icon">ğŸ¬</div>
      <div class="modal-title">Watch & Earn</div>
      <div class="modal-desc">Watch a short ad to earn <strong style="color:var(--gold)">+5 credits</strong>. Credits let you convert voice to instruments and download your tracks.</div>
      <div class="modal-actions">
        <button class="modal-btn modal-btn-primary" onclick="watchAd()">ğŸª™ Watch Ad (+5 credits)</button>
        <button class="modal-btn modal-btn-secondary" onclick="closeModal('earnModal')">Maybe later</button>
      </div>
    </div>
  </div>

  <!-- â”€â”€ Insufficient Credits Modal â”€â”€ -->
  <div class="modal-overlay" id="noCreditsModal">
    <div class="modal">
      <div class="modal-icon">ğŸ˜”</div>
      <div class="modal-title">Not Enough Credits</div>
      <div class="modal-desc" id="noCreditsDesc">You need more credits to do this. Watch a short ad to earn credits for free!</div>
      <div class="modal-actions">
        <button class="modal-btn modal-btn-primary" onclick="closeModal('noCreditsModal'); showEarnModal()">ğŸ¬ Watch Ad & Earn</button>
        <button class="modal-btn modal-btn-secondary" onclick="closeModal('noCreditsModal')">Cancel</button>
      </div>
    </div>
  </div>

  <!-- â”€â”€ Ad Loading / Simulated Rewarded Ad â”€â”€ -->
  <div class="ad-loading" id="adLoadingScreen">
    <div class="ad-spinner"></div>
    <div class="ad-loading-text">Loading ad...</div>
    <div class="ad-countdown" id="adCountdown" style="display:none"></div>
    <div class="ad-skip-area">
      <button class="ad-skip-btn" id="adSkipBtn" onclick="adEnded()">Skip Ad â€º</button>
      <div class="ad-note" id="adNote" style="display:none">You'll earn credits when the ad completes or is skipped.</div>
    </div>
  </div>

  <!-- â”€â”€ Processing Overlay â”€â”€ -->
  <div class="processing-overlay" id="processingOverlay">
    <div class="processing-ring"></div>
    <div class="processing-text">CONVERTING...</div>
    <div class="processing-sub" id="processingInstrument">Transforming to Piano</div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let credits       = 10;
    let isRecording   = false;
    let hasRecording  = false;
    let selectedInst  = null;
    let adTimer       = null;
    let adSeconds     = 0;
    let recordTimer   = null;
    let recordSeconds = 0;

    const INSTRUMENTS = [
      { id: 'piano',   name: 'Piano',       icon: 'ğŸ¹', cost: 2 },
      { id: 'guitar',  name: 'Guitar',      icon: 'ğŸ¸', cost: 2 },
      { id: 'violin',  name: 'Violin',      icon: 'ğŸ»', cost: 3 },
      { id: 'flute',   name: 'Flute',       icon: 'ğŸªˆ', cost: 2 },
      { id: 'trumpet', name: 'Trumpet',     icon: 'ğŸº', cost: 3 },
      { id: 'drums',   name: 'Drums',       icon: 'ğŸ¥', cost: 2 },
      { id: 'synth',   name: 'Synth',       icon: 'ğŸ›ï¸', cost: 4 },
      { id: 'bass',    name: 'Bass Guitar', icon: 'ğŸ¸', cost: 3 },
    ];

    const CONVERT_COST  = 2;  // credits to convert
    const DOWNLOAD_COST = 1;  // credits to download
    const AD_REWARD     = 5;  // credits per ad watched
    const AD_DURATION   = 15; // seconds (simulate rewarded ad)

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  INIT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function init() {
      renderInstruments();
      updateCreditsDisplay();
    }

    function renderInstruments() {
      const grid = document.getElementById('instrumentsGrid');
      grid.innerHTML = INSTRUMENTS.map(inst => `
        <div class="instrument-card" id="inst-${inst.id}" onclick="selectInstrument('${inst.id}')">
          <span class="instrument-icon">${inst.icon}</span>
          <div class="instrument-name">${inst.name}</div>
          <div class="instrument-cost">ğŸª™ ${inst.cost} credits</div>
        </div>
      `).join('');
    }

    function updateCreditsDisplay() {
      document.getElementById('creditsDisplay').textContent = credits;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  RECORDING
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function toggleRecord() {
      if (isRecording) stopRecord();
      else startRecord();
    }

    function startRecord() {
      isRecording = true;
      hasRecording = false;
      recordSeconds = 0;

      document.getElementById('recordBtn').classList.add('recording');
      document.getElementById('recordStatus').textContent = 'Recording...';
      document.getElementById('recordStatus').classList.add('active');
      document.getElementById('waveform').classList.add('active');
      document.getElementById('micIcon').innerHTML = '<rect x="8" y="8" width="8" height="8" rx="2"/>'; // stop icon

      recordTimer = setInterval(() => {
        recordSeconds++;
        document.getElementById('recordStatus').textContent = `Recording... ${recordSeconds}s`;
        if (recordSeconds >= 30) stopRecord(); // auto-stop at 30s
      }, 1000);

      showToast('ğŸ™ï¸ Recording started', '');
    }

    function stopRecord() {
      isRecording = false;
      clearInterval(recordTimer);

      document.getElementById('recordBtn').classList.remove('recording');
      document.getElementById('recordStatus').textContent = `Recording saved (${recordSeconds}s)`;
      document.getElementById('recordStatus').classList.remove('active');
      document.getElementById('waveform').classList.remove('active');
      document.getElementById('micIcon').innerHTML = '<path d="M12 1a4 4 0 0 1 4 4v6a4 4 0 0 1-8 0V5a4 4 0 0 1 4-4zm7 10a1 1 0 0 1 2 0 9 9 0 0 1-8 8.94V21h2a1 1 0 0 1 0 2H9a1 1 0 0 1 0-2h2v-1.06A9 9 0 0 1 3 11a1 1 0 0 1 2 0 7 7 0 0 0 14 0z"/>';

      if (recordSeconds >= 1) {
        hasRecording = true;
        checkConvertReady();
        showToast('âœ… Recording saved!', 'success');
      } else {
        document.getElementById('recordStatus').textContent = 'Too short â€” tap and hold to record';
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  INSTRUMENT SELECTION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function selectInstrument(id) {
      // Deselect previous
      if (selectedInst) {
        document.getElementById('inst-' + selectedInst).classList.remove('selected');
      }
      selectedInst = id;
      document.getElementById('inst-' + id).classList.add('selected');

      const inst = INSTRUMENTS.find(i => i.id === id);
      document.getElementById('convertCostLabel').textContent = `${inst.cost} ğŸª™`;
      checkConvertReady();
    }

    function checkConvertReady() {
      const btn = document.getElementById('convertBtn');
      btn.disabled = !(hasRecording && selectedInst);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  CONVERT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function startConvert() {
      if (!hasRecording || !selectedInst) return;

      const inst = INSTRUMENTS.find(i => i.id === selectedInst);
      if (credits < inst.cost) {
        document.getElementById('noCreditsDesc').textContent =
          `You need ${inst.cost} credits to convert to ${inst.name}. Watch a short ad to earn free credits!`;
        openModal('noCreditsModal');
        return;
      }

      // Deduct credits
      credits -= inst.cost;
      updateCreditsDisplay();

      // Show processing
      document.getElementById('processingInstrument').textContent = `Transforming to ${inst.name}`;
      document.getElementById('processingOverlay').classList.add('open');

      // Simulate AI processing (2â€“4 seconds)
      const delay = 2000 + Math.random() * 2000;
      setTimeout(() => {
        document.getElementById('processingOverlay').classList.remove('open');
        showResult(inst);
      }, delay);
    }

    function showResult(inst) {
      document.getElementById('resultTitle').textContent = `${inst.icon} ${inst.name} Version`;
      document.getElementById('resultPanel').classList.add('visible');
      document.getElementById('resultPanel').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      showToast(`ğŸ¶ ${inst.name} conversion ready!`, 'success');
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  PLAY / DOWNLOAD
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function playResult() {
      showToast('â–¶ Playing preview...', '');
      // In real app: play the converted audio file
    }

    function downloadResult() {
      if (credits < DOWNLOAD_COST) {
        document.getElementById('noCreditsDesc').textContent =
          `You need ${DOWNLOAD_COST} credit to download. Watch an ad to earn free credits!`;
        openModal('noCreditsModal');
        return;
      }
      credits -= DOWNLOAD_COST;
      updateCreditsDisplay();
      showToast('â¬‡ Downloading...', 'success');
      // In real app: trigger file download
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  AD / EARN CREDITS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function showEarnModal() { openModal('earnModal'); }

    function watchAd() {
      closeModal('earnModal');

      // â”€â”€ ADMOB INTEGRATION POINT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // In the compiled Android WebView app, call:
      //   Android.showRewardedAd()   â† from your Java/Kotlin bridge
      // The Android side will call window.onAdRewarded() when done.
      //
      // For web preview, we simulate a 15-second ad below:
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      if (window.Android && typeof window.Android.showRewardedAd === 'function') {
        window.Android.showRewardedAd();
      } else {
        simulateRewardedAd();
      }
    }

    // Called by Android WebView bridge after rewarded ad completes
    window.onAdRewarded = function() {
      credits += AD_REWARD;
      updateCreditsDisplay();
      showToast(`ğŸª™ +${AD_REWARD} credits earned!`, 'success');
    };

    function simulateRewardedAd() {
      adSeconds = AD_DURATION;
      const loadingScreen = document.getElementById('adLoadingScreen');
      const countdown     = document.getElementById('adCountdown');
      const skipBtn       = document.getElementById('adSkipBtn');
      const adNote        = document.getElementById('adNote');
      const loadingText   = document.querySelector('.ad-loading-text');

      loadingScreen.classList.add('open');
      loadingText.textContent = 'Loading ad...';
      countdown.style.display = 'none';
      skipBtn.style.display = 'none';
      adNote.style.display = 'none';

      // Simulate load delay
      setTimeout(() => {
        loadingText.textContent = 'ğŸ“º Ad Playing';
        countdown.style.display = 'block';
        adNote.style.display = 'block';
        countdown.textContent = adSeconds + 's';

        adTimer = setInterval(() => {
          adSeconds--;
          countdown.textContent = adSeconds + 's';

          // Show skip after 5 seconds
          if (adSeconds <= AD_DURATION - 5) {
            skipBtn.style.display = 'block';
          }

          if (adSeconds <= 0) {
            clearInterval(adTimer);
            adEnded();
          }
        }, 1000);
      }, 1500);
    }

    function adEnded() {
      clearInterval(adTimer);
      document.getElementById('adLoadingScreen').classList.remove('open');
      window.onAdRewarded();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  MODALS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function openModal(id)  { document.getElementById(id).classList.add('open'); }
    function closeModal(id) { document.getElementById(id).classList.remove('open'); }

    // Close modals on backdrop click
    document.querySelectorAll('.modal-overlay').forEach(el => {
      el.addEventListener('click', e => {
        if (e.target === el) el.classList.remove('open');
      });
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  TOAST
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let toastTimeout;
    function showToast(msg, type) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.className = 'toast show' + (type ? ' ' + type : '');
      clearTimeout(toastTimeout);
      toastTimeout = setTimeout(() => toast.classList.remove('show'), 2800);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  START
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    init();
  </script>

  <!--
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘            ANDROID WEBVIEW INTEGRATION NOTES              â•‘
  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
  â•‘                                                           â•‘
  â•‘  1. Wrap this HTML in an Android WebView Activity         â•‘
  â•‘  2. Enable JavaScript: webView.getSettings()             â•‘
  â•‘                        .setJavaScriptEnabled(true)        â•‘
  â•‘  3. Add JavaScript Interface:                             â•‘
  â•‘       webView.addJavascriptInterface(                     â•‘
  â•‘         new AdMobBridge(this), "Android")                 â•‘
  â•‘                                                           â•‘
  â•‘  4. In AdMobBridge.java:                                  â•‘
  â•‘       @JavascriptInterface                                â•‘
  â•‘       public void showRewardedAd() {                      â•‘
  â•‘         rewardedAd.show(activity, rewardItem -> {         â•‘
  â•‘           webView.loadUrl(                                â•‘
  â•‘             "javascript:window.onAdRewarded()");          â•‘
  â•‘         });                                               â•‘
  â•‘       }                                                   â•‘
  â•‘                                                           â•‘
  â•‘  5. Replace ad unit IDs:                                  â•‘
  â•‘     Banner:   ca-app-pub-XXXXXX/XXXXXX                    â•‘
  â•‘     Rewarded: ca-app-pub-XXXXXX/XXXXXX                    â•‘
  â•‘                                                           â•‘
  â•‘  6. Add to AndroidManifest.xml:                           â•‘
  â•‘     <meta-data                                            â•‘
  â•‘       android:name="com.google.android.gms.ads.APPLICATION_ID"
  â•‘       android:value="ca-app-pub-XXXXXXXXXXXXXXXX~XXXXXXXXXX"/>
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  -->

</body>
</html>
